<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Sản Phẩm với Bộ Lọc</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            padding-top: 75px;
        }

        /* Header Styles */
        .navbar {
          position: fixed;
          top: 0;
          width: 100%;
          display: flex;
          justify-content: space-between;
          align-items: center;
          background-color: #333;
          padding: 10px 5%;
          flex-wrap: wrap;
          z-index: 1000;
        }

        .logo img {
            height: 50px;
            max-width: 100%;
            transition: all 0.3s ease;
        }

        .nav-links {
            display: flex;
            gap: 15px;
        }

        .nav-links ul {
            display: flex;
            list-style: none;
            gap: 15px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            background-color: #555;
            border-radius: 5px;
        }

        .search-bar {
            display: flex;
            margin: 10px 0;
            flex-grow: 1;
            max-width: 400px;
            padding: 0 15px;
        }

        .search-bar-text {
            flex-grow: 1;
            padding: 8px;
            border: none;
            border-radius: 4px 0 0 4px;
        }

        .search-bar button {
            padding: 8px 15px;
            background-color: #ff6347;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }

        .nav-icons {
            display: flex;
            gap: 60px;
        }

        .user-icon img{
            height: 30px;
        }
        .cart-icon img {
            height: 30px;
            filter: brightness(0) invert(1);
            transition: all 0.3s ease;
        }

        .container {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
            position: relative;
        }

        /* Sidebar Filter */
        .filter-sidebar {
            width: 250px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 95px;
            height: calc(100vh - 115px);
            overflow-y: auto;
        }

        .filter-section {
            margin-bottom: 25px;
        }

        .filter-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-option input[type="checkbox"],
        .filter-option input[type="radio"] {
            width: 16px;
            height: 16px;
        }

        .price-range {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .price-range input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .color-option.selected {
            border-color: #333;
        }

        .size-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .size-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        .size-option.selected {
            background: #333;
            color: white;
        }

        /* Product Grid */
        .product-grid {
            flex: 1;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .sort-options select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-info {
            padding: 15px;
        }

        .product-brand {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .product-name {
            font-weight: bold;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .current-price {
            font-weight: bold;
            font-size: 18px;
            color: #e74c3c;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 14px;
        }

        .discount {
            background: #e74c3c;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .add-to-cart {
            width: 100%;
            padding: 10px;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .add-to-cart:hover {
            background: #555;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            padding: 20px 0;
        }

        .pagination a {
            color: #333;
            padding: 8px 16px;
            text-decoration: none;
            border: 1px solid #ddd;
            margin: 0 4px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .pagination a.active {
            background-color: #333;
            color: white;
            border: 1px solid #333;
        }

        .pagination a:hover:not(.active) {
            background-color: #ddd;
        }

        /* Product Detail Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 8px;
            width: 80%;
            max-width: 900px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 25px;
            top: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #333;
        }

        .product-detail {
            display: flex;
            gap: 30px;
        }

        .product-detail-images {
            flex: 1;
        }

        .main-image {
            width: 100%;
            height: 400px;
            object-fit: contain;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .thumbnail-container {
            display: flex;
            gap: 10px;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid #ddd;
        }

        .thumbnail:hover {
            border-color: #333;
        }

        .product-detail-info {
            flex: 1;
        }

        .product-detail-brand {
            color: #666;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .product-detail-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .product-detail-price {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .product-detail-current {
            font-size: 24px;
            color: #e74c3c;
            font-weight: bold;
        }

        .product-detail-original {
            text-decoration: line-through;
            color: #999;
        }

        .product-detail-discount {
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }

        .product-detail-description {
            margin: 20px 0;
            line-height: 1.6;
        }

        .product-detail-options {
            margin: 20px 0;
        }

        .option-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .detail-size-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .detail-size-option {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        .detail-size-option.selected {
            background: #333;
            color: white;
        }

        .detail-color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .detail-color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .detail-color-option.selected {
            border-color: #333;
        }

        .add-to-cart-detail {
            padding: 12px 25px;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
            margin-top: 20px;
        }

        .add-to-cart-detail:hover {
            background: #555;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .product-detail {
                flex-direction: column;
            }

            .main-image {
                height: 300px;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .filter-sidebar {
                width: 100%;
                position: static;
                height: auto;
                margin-bottom: 20px;
            }

            .products {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .modal-content {
                width: 95%;
                padding: 15px;
            }

            .product-detail {
                gap: 15px;
            }
        }
        /* Product Reviews Section */
.product-reviews-section {
    margin-top: 40px;
    padding-top: 30px;
    border-top: 1px solid #eee;
}

.reviews-title {
    font-size: 24px;
    margin-bottom: 20px;
    color: #333;
}

/* Rating Summary */
.rating-summary {
    display: flex;
    margin-bottom: 30px;
    padding: 20px;
    background-color: #f9f9f9;
    border-radius: 8px;
}

.average-rating {
    text-align: center;
    padding: 0 30px;
    border-right: 1px solid #ddd;
}

.average-score {
    font-size: 48px;
    font-weight: bold;
    display: block;
    color: #333;
}

.rating-distribution {
    flex: 1;
    padding-left: 30px;
}

.rating-bar {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.star-label {
    width: 60px;
    font-size: 14px;
}

.bar-container {
    flex: 1;
    height: 10px;
    background-color: #e0e0e0;
    border-radius: 5px;
    margin: 0 10px;
}

.bar-fill {
    height: 100%;
    background-color: #ffc107;
    border-radius: 5px;
}

.percentage {
    width: 40px;
    text-align: right;
    font-size: 14px;
}

/* Reviews List */
.reviews-list {
    margin-bottom: 30px;
}

.review-item {
    padding: 20px 0;
    border-bottom: 1px solid #eee;
}

.reviewer-info {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.reviewer-name {
    font-weight: bold;
    margin-right: 15px;
}

.review-rating {
    color: #ffc107;
    margin-right: 15px;
}

.review-date {
    color: #777;
    font-size: 14px;
}

.review-title {
    font-size: 18px;
    margin-bottom: 10px;
    color: #333;
}

.review-text {
    color: #555;
    line-height: 1.6;
}

.review-images {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.review-image {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 4px;
    cursor: pointer;
}

/* Write Review Button */
.write-review-btn {
    background-color: #2e7d32;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 4px;
    font-size: 16px;
    cursor: pointer;
    display: block;
    margin: 0 auto;
    transition: background-color 0.3s;
}

.write-review-btn:hover {
    background-color: #1b5e20;
}

/* Rating Stars */
.rating-stars {
    color: #ffc107;
    font-size: 16px;
}

.rating-count {
    color: #777;
    font-size: 14px;
    margin-left: 10px;
}
    </style>
</head>
<body>
<header class="navbar">
    <div class="logo">
        <img src="https://png.pngtree.com/template/20200809/ourmid/pngtree-modern-sneaker-shoe-logo-image_401564.jpg" alt="Shop Giày">
    </div>

    <nav class="nav-links">
        <ul> 
            <li><a href="../templates/HTML/home.html">Trang chủ</a></li>
            <li><a href="test3.html">Sản phẩm</a></li>
            <li><a href="#">Danh mục</a></li>
            <li><a href="#">Khuyến mãi</a></li>
            <li><a href="#">Liên Hệ</a></li>
        </ul>
    </nav>

    <div class="search-bar">
        <input class="search-bar-text" type="text" placeholder="Tìm kiếm sản phẩm...">
        <button type="submit">Tìm</button>
    </div>

    <div class="nav-icons">
        <a href="#" class="cart-icon"><img src="https://cdn-icons-png.flaticon.com/512/1170/1170678.png" alt="Giỏ hàng"></a>
        <div class="account-dropdown">
          <a href="#" class="user-icon" onclick="toggleDropdown(event)">
            <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Tài khoản">
          </a>
          <div class="dropdown-content" id="dropdownMenu">
            <a href="http://localhost:8080/api/users"><i class="icon-user"></i> Tài Khoản Của Tôi</a>
            <a href="http://localhost:8080/api/orders"><i class="icon-orders"></i> Đơn Mua</a>
            <a href="/returns"><i class="icon-returns"></i> Trả hàng/Hoàn tiền</a>
            <a href="#" onclick="handleLogout(event)">
              <i class="icon-logout"></i> Đăng Xuất
            </a>
            
            <script>
              async function handleLogout(event) {
                event.preventDefault();
                const token = localStorage.getItem("authToken");
                try {
                  const response = await fetch('http://localhost:8080/api/auth/logout', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                       "Authorization": `Bearer ${token}`
                      // 'X-CSRF-TOKEN': 'YOUR_CSRF_TOKEN_HERE' // Nếu cần
                    },
                   // credentials: 'include' // Cần thiết nếu sử dụng cookie/session
                  }).then(res => {
                      if (res.ok) {
                            alert("Logout thành công!");
                              localStorage.removeItem("authToken"); // Xoá token sau khi logout
                              window.location.href = "http://127.0.0.1:5500/src/main/resources/templates/HTML/home.html";
                                } else {
                             alert("Lỗi khi logout");
                                   }
                                });
              
                } catch (error) {
                  console.error('Error during logout:', error);
                }
              }
            </script>
          </div>
        </div>
        
        <style>
          .account-dropdown {
            position: relative;
            display: inline-block;
          }
          
          .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: white;
            min-width: 200px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 4px;
            z-index: 1000;
            padding: 8px 0;
          }
          
          .dropdown-content a {
            color: #333;
            padding: 10px 16px;
            text-decoration: none;
            display: block;
            font-size: 14px;
            transition: background-color 0.2s;
          }
          
          .dropdown-content a:hover {
            background-color: #f5f5f5;
          }
          
          .dropdown-content a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
          }
          
          .user-icon img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
          }
        </style>
        
        <script>
          function toggleDropdown(event) {
            event.preventDefault();
            event.stopPropagation();
            const menu = document.getElementById('dropdownMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
          }
          
          // Đóng menu khi click ra ngoài
          document.addEventListener('click', function(event) {
            const menu = document.getElementById('dropdownMenu');
            if (!event.target.closest('.account-dropdown') && menu.style.display === 'block') {
              menu.style.display = 'none';
            }
          });
        </script>
    </div>
</header>

<div class="container">
    <!-- Filter Sidebar -->
    <aside class="filter-sidebar">
        <div class="filter-section">
            <h3 class="filter-title">Hãng sản xuất</h3>
            <div class="filter-options">
                <label class="filter-option">
                    <input type="checkbox" name="brand" value="nike" checked> Nike
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="brand" value="adidas" checked> Adidas
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="brand" value="puma" checked> Puma
                </label>
                <label class="filter-option">
                    <input type="checkbox" name="brand" value="new-balance" checked> New Balance
                </label>
            </div>
        </div>

        <div class="filter-section">
            <h3 class="filter-title">Mức giá</h3>
            <div class="filter-options">
                <label class="filter-option">
                    <input type="radio" name="price" value="all" checked> Tất cả
                </label>
                <label class="filter-option">
                    <input type="radio" name="price" value="under1m"> Dưới 1 triệu
                </label>
                <label class="filter-option">
                    <input type="radio" name="price" value="1m-2m"> 1 - 2 triệu
                </label>
                <label class="filter-option">
                    <input type="radio" name="price" value="2m-3m"> 2 - 3 triệu
                </label>
                <label class="filter-option">
                    <input type="radio" name="price" value="over3m"> Trên 3 triệu
                </label>
            </div>
            <div class="price-range">
                <input type="number" placeholder="Từ" min="0">
                <input type="number" placeholder="Đến" min="0">
            </div>
        </div>

        <button id="apply-filters" style="width: 100%; padding: 10px; margin-top: 20px; background: #333; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Áp dụng bộ lọc
        </button>
    </aside>

    <!-- Product Grid -->
    <main class="product-grid">
        <div class="product-header">
            <h2>Giày thể thao</h2>
            <div class="sort-options">
                <select id="sort-by">
                    <option value="default">Sắp xếp theo</option>
                    <option value="price-asc">Giá thấp đến cao</option>
                    <option value="price-desc">Giá cao đến thấp</option>
                    <option value="popular">Bán chạy nhất</option>
                    <option value="newest">Mới nhất</option>
                </select>
            </div>
        </div>
       
        <div class="product-list">
            <div id="products-container" class="products">
                <!-- Products will be loaded here by JavaScript -->
            </div>
        </div>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
          const productsContainer = document.getElementById('products-container');
          const baseUrl = 'http://localhost:8080/products'; // Update with your actual API URL
          
          // Function to fetch all products
          async function fetchAllProducts() {
              try {
                  const response = await fetch(baseUrl);
                  if (!response.ok) {
                      throw new Error('Network response was not ok');
                  }
                  const products = await response.json();
                  displayProducts(products);
              } catch (error) {
                  console.error('Error fetching products:', error);
                  productsContainer.innerHTML = '<p>Error loading products. Please try again later.</p>';
              }
          }
          
          // Function to search products
          async function searchProducts(keyword, page = 0, size = 10) {
              try {
                  const url = `${baseUrl}/search?keyword=${encodeURIComponent(keyword)}&page=${page}&size=${size}`;
                  const response = await fetch(url);
                  if (!response.ok) {
                      throw new Error('Network response was not ok');
                  }
                  const products = await response.json();
                  displayProducts(products);
              } catch (error) {
                  console.error('Error searching products:', error);
                  productsContainer.innerHTML = '<p>Error searching products. Please try again.</p>';
              }
          }
          
          // Function to display products
          function displayProducts(products) {
              if (!products || products.length === 0) {
                  productsContainer.innerHTML = '<p>No products found.</p>';
                  return;
              }
              
              productsContainer.innerHTML = '';
              
              products.forEach(product => {
                  const productElement = document.createElement('div');
                  productElement.className = 'product';
                  productElement.innerHTML = `
                      <div class="product-image">
                          <img src="${product.imageUrl || 'placeholder.jpg'}" alt="${product.name}">
                      </div>
                      <div class="product-details">
                          <h3>${product.name}</h3>
                          <p>${product.description || 'No description available'}</p>
                          <p>Price: $${product.price || 'N/A'}</p>
                          <p>Brand: ${product.brand || 'N/A'}</p>
                          <button onclick="viewProductDetails(${product.id})">View Details</button>
                      </div>
                  `;
                  productsContainer.appendChild(productElement);
              });
          }
          
          // Example functions for product actions
          window.viewProductDetails = async function(productId) {
              try {
                  const response = await fetch(`${baseUrl}/${productId}`);
                  if (!response.ok) {
                      throw new Error('Network response was not ok');
                  }
                  const product = await response.json();
                  // Display product details in a modal or redirect to detail page
                  alert(`Product Details:\nName: ${product.name}\nPrice: $${product.price}\nDescription: ${product.description}`);
              } catch (error) {
                  console.error('Error fetching product details:', error);
                  alert('Error loading product details.');
              }
          };
          
          
          // Initial load
          fetchAllProducts();
          
          // Search functionality (example with a search button)
          const searchButton = document.getElementById('search-button'); // Add this to your HTML
          const searchInput = document.getElementById('search-input'); // Add this to your HTML
          
          if (searchButton && searchInput) {
              searchButton.addEventListener('click', () => {
                  const keyword = searchInput.value.trim();
                  if (keyword) {
                      searchProducts(keyword);
                  } else {
                      fetchAllProducts();
                  }
              });
          }
      });</script>

        <!-- Pagination -->
        <div class="pagination" id="pagination">
            <!-- Pagination links will be generated by JavaScript -->
        </div>
    </main>
</div>



<!-- Product Detail Modal -->
<div id="productModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div class="product-detail" id="product-detail-content">
            <!-- Product detail will be loaded here -->
        </div>
    </div>
</div>

<script>

  // DOM Elements
  const productsContainer = document.getElementById('products-container');
  const paginationContainer = document.getElementById('pagination');
  const modal = document.getElementById('productModal');
  const closeModal = document.querySelector('.close');
  const productDetailContent = document.getElementById('product-detail-content');
  const applyFiltersBtn = document.getElementById('apply-filters');
  const sortBySelect = document.getElementById('sort-by');

  // Variables
  let currentPage = 1;
  const productsPerPage = 9;
  let filteredProducts = [...products];

  // Initialize the page
  function init() {
    displayProducts();
    setupPagination();
    setupEventListeners();
  }

  // Display products for current page
  function displayProducts() {
    productsContainer.innerHTML = '';

    const startIndex = (currentPage - 1) * productsPerPage;
    const endIndex = startIndex + productsPerPage;
    const productsToDisplay = filteredProducts.slice(startIndex, endIndex);

    if (productsToDisplay.length === 0) {
      productsContainer.innerHTML = '<p style="grid-column: 1 / -1; text-align: center;">Không tìm thấy sản phẩm phù hợp</p>';
      return;
    }

    productsToDisplay.forEach(product => {
      const discount = Math.round((1 - product.price / product.originalPrice) * 100);

      const productCard = document.createElement('div');
      productCard.className = 'product-card';
      productCard.innerHTML = `
        <img src="${product.image}" alt="${product.name}" class="product-image">
        <div class="product-info">
          <div class="product-brand">${product.brand}</div>
          <div class="product-name">${product.name}</div>
          <div class="product-price">
            <span class="current-price">${formatPrice(product.price)}</span>
            <span class="original-price">${formatPrice(product.originalPrice)}</span>
            <span class="discount">-${discount}%</span>
          </div>
          <button class="add-to-cart">Thêm vào giỏ hàng</button>
        </div>
      `;

      productCard.addEventListener('click', () => showProductDetail(product));
      productsContainer.appendChild(productCard);
    });
  }

  // Format price with VND
  function formatPrice(price) {
    return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price);
  }

 
  function setupPagination() {
    const pageCount = Math.ceil(filteredProducts.length / productsPerPage);

    paginationContainer.innerHTML = '';

    if (pageCount <= 1) return;

    // Previous button
    if (currentPage > 1) {
        const prevLink = document.createElement('a');
        prevLink.href = '#';
        prevLink.innerHTML = '&laquo;';
        prevLink.addEventListener('click', (e) => {
            e.preventDefault();
            currentPage--;
            displayProducts();
            setupPagination();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        paginationContainer.appendChild(prevLink);
    }

    // Page numbers logic
    if (pageCount <= 6) {
        // Hiển thị tất cả các trang nếu số trang <= 6
        for (let i = 1; i <= pageCount; i++) {
            const pageLink = document.createElement('a');
            pageLink.href = '#';
            pageLink.textContent = i;
            if (i === currentPage) {
                pageLink.className = 'active';
            }
            pageLink.addEventListener('click', (e) => {
                e.preventDefault();
                currentPage = i;
                displayProducts();
                setupPagination();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            paginationContainer.appendChild(pageLink);
        }
    } else {
        // Hiển thị phân trang với định dạng [1] [2] [3] [...] [n-2] [n-1] [n]
        if (currentPage > 3) {
            // Trang đầu tiên
            const firstPage = document.createElement('a');
            firstPage.href = '#';
            firstPage.textContent = '1';
            firstPage.addEventListener('click', (e) => {
                e.preventDefault();
                currentPage = 1;
                displayProducts();
                setupPagination();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            paginationContainer.appendChild(firstPage);

            // Dấu "..."
            const dots = document.createElement('span');
            dots.textContent = '...';
            paginationContainer.appendChild(dots);
        }

        // Hiển thị các trang xung quanh trang hiện tại
        const startPage = Math.max(1, currentPage - 1);
        const endPage = Math.min(pageCount, currentPage + 1);

        for (let i = startPage; i <= endPage; i++) {
            const pageLink = document.createElement('a');
            pageLink.href = '#';
            pageLink.textContent = i;
            if (i === currentPage) {
                pageLink.className = 'active';
            }
            pageLink.addEventListener('click', (e) => {
                e.preventDefault();
                currentPage = i;
                displayProducts();
                setupPagination();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            paginationContainer.appendChild(pageLink);
        }

        if (currentPage < pageCount - 2) {
            // Dấu "..."
            const dots = document.createElement('span');
            dots.textContent = '...';
            paginationContainer.appendChild(dots);

            // Trang cuối cùng
            const lastPage = document.createElement('a');
            lastPage.href = '#';
            lastPage.textContent = pageCount;
            lastPage.addEventListener('click', (e) => {
                e.preventDefault();
                currentPage = pageCount;
                displayProducts();
                setupPagination();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            paginationContainer.appendChild(lastPage);
        }
    }

    // Next button
    if (currentPage < pageCount) {
        const nextLink = document.createElement('a');
        nextLink.href = '#';
        nextLink.innerHTML = '&raquo;';
        nextLink.addEventListener('click', (e) => {
            e.preventDefault();
            currentPage++;
            displayProducts();
            setupPagination();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        paginationContainer.appendChild(nextLink);
    }
}

function showProductDetail(product) {
    const discount = Math.round((1 - product.price / product.originalPrice) * 100);

    productDetailContent.innerHTML = `
      <div class="product-detail-container">
        <!-- Product Info Section -->
        <div class="product-main-section">
          <div class="product-detail-images">
            <img src="${product.images[0]}" alt="${product.name}" class="main-image" id="main-image">
            <div class="thumbnail-container">
              ${product.images.map((img, index) => `
                <img src="${img}" alt="${product.name}" class="thumbnail" data-index="${index}">
              `).join('')}
            </div>
          </div>
          <div class="product-detail-info">
            <div class="product-detail-brand">${product.brand}</div>
            <h1 class="product-detail-name">${product.name}</h1>
            <div class="product-detail-price">
              <span class="product-detail-current">${formatPrice(product.price)}</span>
              <span class="product-detail-original">${formatPrice(product.originalPrice)}</span>
              <span class="product-detail-discount">-${discount}%</span>
            </div>
<!--            <div class="product-detail-rating">-->
<!--              <div class="rating-stars">-->
<!--                ${generateRatingStars(product.averageRating)}-->
<!--              </div>-->
<!--              <span class="rating-count">(${product.reviewCount} đánh giá)</span>-->
<!--            </div>-->

            <div class="product-detail-options">
              <div class="option-title">Kích cỡ:</div>
              <div class="detail-size-options">
                ${product.sizes.map(size => `
                  <div class="detail-size-option">${size}</div>
                `).join('')}
              </div>
            </div>
            <div class="product-detail-options">
              <div class="option-title">Màu sắc:</div>
              <div class="detail-color-options">
                ${product.colors.map(color => `
                  <div class="detail-color-option" style="background: ${color};"></div>
                `).join('')}
              </div>
            </div>
            <button class="add-to-cart-detail">Thêm vào giỏ hàng</button>
            <div class="product-detail-description">
                <h2 class="reviews-title">Mô tả sản phẩm</h2>
              <p>${product.description}</p>
            </div>
          </div>
        </div>

        <!-- Reviews Section -->
        <div class="product-reviews-section">
          <h2 class="reviews-title">Đánh giá sản phẩm</h2>

          <!-- Rating Summary -->
          <div class="rating-summary">
            <div class="average-rating">
              <span class="average-score">${product.averageRating.toFixed(1)}</span>
              <div class="rating-stars">${generateRatingStars(product.averageRating)}</div>
              <span class="total-reviews">${product.reviewCount} đánh giá</span>
            </div>
            <div class="rating-distribution">
              ${[5,4,3,2,1].map(star => `
                <div class="rating-bar">
                  <span class="star-label">${star} sao</span>
                  <div class="bar-container">
                    <div class="bar-fill" style="width: ${getPercentageForStar(product.ratings, star)}%"></div>
                  </div>
                  <span class="percentage">${getPercentageForStar(product.ratings, star)}%</span>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- Reviews List -->
          <div class="reviews-list">
            ${product.reviews.map(review => `
              <div class="review-item">
                <div class="reviewer-info">
                  <span class="reviewer-name">${review.userName}</span>
                  <div class="review-rating">${generateRatingStars(review.rating)}</div>
                  <span class="review-date">${formatDate(review.date)}</span>
                </div>
                <div class="review-content">
                  <h3 class="review-title">${review.title}</h3>
                  <p class="review-text">${review.comment}</p>
                </div>
                ${review.images.length > 0 ? `
                  <div class="review-images">
                    ${review.images.map(img => `<img src="${img}" alt="Review image" class="review-image">`).join('')}
                  </div>
                ` : ''}
              </div>
            `).join('')}
          </div>

          <!-- Write Review Button -->
          <button class="write-review-btn">Viết đánh giá</button>
        </div>
      </div>
    `;

    // Setup thumbnail click events
    const thumbnails = document.querySelectorAll('.thumbnail');
    const mainImage = document.getElementById('main-image');
    thumbnails.forEach(thumb => {
      thumb.addEventListener('click', () => {
        mainImage.src = thumb.src;
      });
    });

    // Setup size selection
    const sizeOptions = document.querySelectorAll('.detail-size-option');
    sizeOptions.forEach(option => {
      option.addEventListener('click', () => {
        sizeOptions.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
      });
    });

    // Setup color selection
    const colorOptions = document.querySelectorAll('.detail-color-option');
    colorOptions.forEach(option => {
      option.addEventListener('click', () => {
        colorOptions.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
      });
    });

    // Show the modal
    modal.style.display = 'block';
}

// Helper functions
function generateRatingStars(rating) {
    const fullStars = Math.floor(rating);
    const hasHalfStar = rating % 1 >= 0.5;
    let starsHTML = '';

    for (let i = 1; i <= 5; i++) {
        if (i <= fullStars) {
            starsHTML += '<i class="fas fa-star"></i>';
        } else if (i === fullStars + 1 && hasHalfStar) {
            starsHTML += '<i class="fas fa-star-half-alt"></i>';
        } else {
            starsHTML += '<i class="far fa-star"></i>';
        }
    }

    return starsHTML;
}

function getPercentageForStar(ratings, star) {
    const total = Object.values(ratings).reduce((sum, count) => sum + count, 0);
    return total > 0 ? Math.round((ratings[star] || 0) / total * 100) : 0;
}

function formatDate(dateString) {
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return new Date(dateString).toLocaleDateString('vi-VN', options);
}

  // Filter products based on selected filters
  function filterProducts() {
    const selectedBrands = Array.from(document.querySelectorAll('input[name="brand"]:checked')).map(el => el.value);
    const selectedPrice = document.querySelector('input[name="price"]:checked').value;
    const minPrice = document.querySelector('.price-range input[placeholder="Từ"]').value;
    const maxPrice = document.querySelector('.price-range input[placeholder="Đến"]').value;

    filteredProducts = products.filter(product => {
      // Filter by brand
      if (selectedBrands.length > 0 && !selectedBrands.includes(product.brand.toLowerCase())) {
        return false;
      }

      // Filter by price range
      if (selectedPrice !== 'all') {
        switch (selectedPrice) {
          case 'under1m':
            if (product.price >= 1000000) return false;
            break;
          case '1m-2m':
            if (product.price < 1000000 || product.price > 2000000) return false;
            break;
          case '2m-3m':
            if (product.price < 2000000 || product.price > 3000000) return false;
            break;
          case 'over3m':
            if (product.price <= 3000000) return false;
            break;
        }
      }

      // Filter by custom price range
      if (minPrice && product.price < parseInt(minPrice)) return false;
      if (maxPrice && product.price > parseInt(maxPrice)) return false;

      return true;
    });

    // Sort products
    sortProducts();

    // Reset to first page
    currentPage = 1;

    // Update display
    displayProducts();
    setupPagination();
  }

  // Sort products based on selected option
  function sortProducts() {
    const sortBy = sortBySelect.value;

    switch (sortBy) {
      case 'price-asc':
        filteredProducts.sort((a, b) => a.price - b.price);
        break;
      case 'price-desc':
        filteredProducts.sort((a, b) => b.price - a.price);
        break;
      case 'popular':
        // In a real app, this would sort by popularity (sales, views, etc.)
        filteredProducts.sort(() => Math.random() - 0.5);
        break;
      case 'newest':
        // Assuming newer products have higher IDs
        filteredProducts.sort((a, b) => b.id - a.id);
        break;
      default:
        // Default sorting (original order)
        filteredProducts = [...products].filter(p => filteredProducts.some(fp => fp.id === p.id));
        break;
    }
  }

  // Setup event listeners
  function setupEventListeners() {
    // Apply filters button
    applyFiltersBtn.addEventListener('click', filterProducts);

    // Sort select
    sortBySelect.addEventListener('change', () => {
      sortProducts();
      currentPage = 1;
      displayProducts();
      setupPagination();
    });

    // Close modal
    closeModal.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
  }

  // Initialize the page
  document.addEventListener('DOMContentLoaded', init);
</>
<footer style="background-color: #333; color: white; padding: 20px 0; text-align: center; margin-top: 20px;">
    <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
        <p>&copy; 2025 Shop Giày. All rights reserved.</p>
        <p>
            <a href="#" style="color: #ff6347; text-decoration: none; margin: 0 10px;">Chính sách bảo mật</a> |
            <a href="#" style="color: #ff6347; text-decoration: none; margin: 0 10px;">Điều khoản sử dụng</a> |
            <a href="#" style="color: #ff6347; text-decoration: none; margin: 0 10px;">Liên hệ</a>
        </p>
        <p>Theo dõi chúng tôi:</p>
        <div style="margin-top: 10px;">
            <a href="#" style="margin: 0 10px;"><img src="https://cdn-icons-png.flaticon.com/512/733/733547.png" alt="Facebook" style="width: 24px;"></a>
            <a href="#" style="margin: 0 10px;"><img src="https://cdn-icons-png.flaticon.com/512/733/733558.png" alt="Twitter" style="width: 24px;"></a>
            <a href="#" style="margin: 0 10px;"><img src="https://cdn-icons-png.flaticon.com/512/733/733579.png" alt="Instagram" style="width: 24px;"></a>
        </div>
    </div>
</footer>
</body>
</html>